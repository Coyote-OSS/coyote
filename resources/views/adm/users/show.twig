{% extends 'adm.base' %}
{% block title %}Użytkownicy :: {{ user.name }} :: {{ parent() }}{% endblock %}

{% block container %}
  {{ activity.chartLibrarySource }}

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Konto {{ navigation.mention }}</span>
      <div>
        <a class="btn btn-sm btn-secondary" href="{{ navigation.settings }}">
          {{ icon('adminUserAccountSettings') }}
          Ustawienia konta
        </a>
        <a class="btn btn-sm btn-secondary" href="{{ navigation.profile }}">
          Przejdź do profilu
          {{ icon('adminUserShowProfile') }}
        </a>
      </div>
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>Utworzenie konta: {{ userDetails.accountCreated.ago }}</span>
        <small class="text-muted">{{ userDetails.accountCreated.format }}</small>
      </li>
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>Ostatnie logowanie: {{ userDetails.lastVisit.ago }}</span>
        <small class="text-muted">{{ userDetails.lastVisit.format }}</small>
      </li>
    </ul>
  </div>

  <div class="row">
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header">Wiarygodność konta {{ navigation.mention }}</div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between">
            {{ userDetails.email }}
            <span>
              {% if not userDetails.mailVerified %}
                {{ icon('adminUsersEmailUnverified') }}
                <b>Niepotwierdzony</b>
              {% else %}
                Zweryfikowany
              {% endif %}
            </span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Kartoteka:</span>
            <span>
              {% if userDetails.multiacc is not empty %}
                <a href="{{ userDetails.multiacc.href }}">
                  {{ icon('alertDanger') }}
                  <b>Kartoteka #{{ userDetails.multiacc.id }}</b>
                </a>
              {% else %}
                Brak
              {% endif %}
            </span>
          </li>
          <li class="list-group-item">
            <a class="btn btn-sm btn-secondary" href="{{ navigation.stream }}">
              {{ icon('adminUserFindInLog') }}
              Znajdź w dzienniku zdarzeń
            </a>
            <a class="btn btn-sm btn-secondary" href="{{ navigation.inspect }}">
              {{ icon('adminUserFindFingerprints') }}
              Znajdź fingerprinty
            </a>
            <a class="btn btn-sm btn-secondary" href="{{ navigation.receivedFlags }}">
              {{ icon('adminUserReportReceived') }}
              Otrzymane raporty
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header">Blokada konta {{ navigation.mention }}</div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between">
            <span>Aktywność konta:</span>
            <span>
              {% if userDetails.isDeleted %}
                {{ icon('alertDanger') }}
                <b>Konto usunięte</b>
              {% else %}
                Konto istniejące
              {% endif %}
            </span>
          </li>
          <li class="list-group-item">
            <div class="d-flex justify-content-between">
              <span>Standardowy Ban:</span>
              <span>
                {% if userDetails.isBanned %}
                  {{ icon('alertDanger') }}
                  <b>Zbanowany</b>
                {% else %}
                  Brak
                {% endif %}
              </span>
            </div>
            <div>
              <small class="text-muted">Stan aktualny. Nie dotyczy przeszłych banów.</small>
            </div>
            <small class="text-muted">Nie dotyczy banów na IP ani fingerprint.</small>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Shadow-ban dla {{ navigation.mention }}
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <div class="d-flex justify-content-between">
          <div>
            <div>
              Status:
              {% if userDetails.isIncognito %}
                {{ icon('adminShadowBanActive') }}
                <b>Zbanowany</b>
              {% else %}
                <span class="text-muted">Brak</span>
              {% endif %}
            </div>
            <small class="text-muted">Stan aktualny. Nie dotyczy przeszłych banów.</small>
          </div>
          <div>
            <form method="POST" action="{{ userShadowBanActionUrl }}">
              <input type="hidden" name="_token" value="{{ csrf_token() }}">
              {% if userDetails.isIncognito %}
                <button class="btn btn-sm btn-secondary" type="submit" name="action" value="removeBanShadow">
                  {{ icon('adminShadowBanRevoke') }}
                  Odbierz bana
                </button>
              {% else %}
                <button class="btn btn-sm btn-secondary" type="submit" name="action" value="banShadow">
                  Przyznaj bana
                </button>
              {% endif %}
            </form>
          </div>
        </div>
      </li>
      {% if userDetails.isIncognito %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between">
            <span>
              Przyznany:
              {% if userDetails.incognitoSince %}
                {{ userDetails.incognitoSince.ago }}
              {% else %}
                <span class="text-muted">Brak informacji - ban przyznany przed zapisywaniem daty</span>
              {% endif %}
            </span>
            <span>
              <span class="text-muted">{{ userDetails.incognitoSince.format }}</span>
            </span>
          </div>
        </li>
      {% endif %}
    </ul>
  </div>

  <ul class="nav nav-pills mb-3 justify-content-end">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#pills-days-activity" type="button">ostatnie 30 dni</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-weeks-activity" type="button">ostatnie 30 tygodni</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-months-activity" type="button">ostatnie 30 miesięcy</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-years-activity" type="button">ostatnie 30 lat</button>
    </li>
  </ul>
  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane show active" id="pills-days-activity">
      {{ activityChartDays }}
    </div>
    <div class="tab-pane" id="pills-weeks-activity">
      {{ activityChartWeeks }}
    </div>
    <div class="tab-pane" id="pills-months-activity">
      {{ activityChartMonths }}
    </div>
    <div class="tab-pane" id="pills-years-activity">
      {{ activityChartYears }}
    </div>
  </div>
  
  <div class="card">
    <div class="card-header">
      {{ icon('adminUserStatistics') }}
      Aktywność użytkownika {{ navigation.mention }}
    </div>
    <div class="card-body">
      <div class="btn-group mb-4">
        <a href="?" class="btn btn-secondary">
          {{ icon('adminUserStatisticsAllTime') }}
          Wszystko
        </a>
        <a href="?last=year" type="button" class="btn btn-secondary">
          {{ icon('adminUserStatisticsLastYear') }}
          Ostatnie 365 dni
        </a>
        <a href="?last=month" type="button" class="btn btn-secondary">
          {{ icon('adminUserStatisticsLastMonth') }}
          Ostatnie 31 dni
        </a>
        <a href="?last=week" type="button" class="btn btn-secondary">
          {{ icon('adminUserStatisticsLastWeek') }}
          Ostatnie 7 dni
        </a>
        <a href="?last=day" type="button" class="btn btn-secondary">
          {{ icon('adminUserStatisticsLastDay') }}
          Ostatnie 24h
        </a>
      </div>

      <div class="d-lg-flex">
        <div class="col-lg-6 px-0">
          <div class="card">
            <div class="card-header">
              Posty dodawane w kategoriach ({{ activity.postsStatistic.all }})
            </div>
            <div class="card-body">
              {% if not activity.categoriesChart.empty %}
                {{ activity.categoriesChart }}
              {% else %}
                Użytkownik nie napisał żadnego postu w zadanym zakresie.
              {% endif %}
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              Głosy otrzymane w kategoriach
            </div>
            <div class="card-body">
              {% if not activity.categoriesChartLikes.empty %}
                {{ activity.categoriesChartLikes }}
              {% else %}
                Użytkownik nie otrzymał żadnego głosu w zadanym zakresie.
              {% endif %}
            </div>
          </div>
        </div>
        <div class="col-lg-6 px-0 ps-lg-3">
          <div class="card">
            <div class="card-header">
              Usunięte posty
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                Postów usuniętych przez siebie:
                <b> {{ activity.postsStatistic.deletedBySelf }}</b>
                <span class="text-muted">
                  {{ activity.postsStatistic.deletedBySelfProportion }}
                </span>
              </li>
              <li class="list-group-item">
                Postów usuniętych przez moderatora:
                <b>{{ activity.postsStatistic.deletedByModerator }}</b>
                <span class="text-muted">
                  {{ activity.postsStatistic.deletedByModeratorProportion }}
                </span>
                {% if not activity.deleteReasonsChart.empty %}
                  <div class="mt-3">
                    {{ activity.deleteReasonsChart }}
                  </div>
                {% endif %}
              </li>
            </ul>
          </div>
          <div class="card">
            <div class="card-header">
              Powody zgłoszeń na posty użytkownika
            </div>
            <div class="card-body">
              {% if not activity.reportReasonsChart.empty %}
                <div class="mt-3">
                  {{ activity.reportReasonsChart }}
                </div>
              {% else %}
                Użytkownik nie otrzymał zgłoszeń w zadanym zakresie.
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      {{ icon('adminMassDelete') }}
      Masowe usuwanie treści {{ navigation.mention }}
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        Rozpoczętych wątków: <b>{{ userContent.topics }}</b>
      </li>
      <li class="list-group-item">
        <div class="d-flex justify-content-between">
          <span>
            Napisanych postów: <b title="Postów na forum (wyłączając usunięte)">{{ userContent.posts }}</b>
            /
            <b title="Usuniętych postów">{{ userContent.postsDeleted }}</b>
          </span>
          <a href="{{ navigation.posts }}">
            {{ icon('adminUserPosts') }}
            Pokaż
          </a>
        </div>
        <small class="text-muted">W tym postów rozpoczynających wątki.</small>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <span>
          Napisanych komentarzy pod postami:
          <b title="Komentarzy na forum (wyłączając usunięte)">{{ userContent.postComments }}</b>
          /
          <b title="Usuniętych komentarzy">{{ userContent.postCommentsDeleted }}</b>
        </span>
        <a href="{{ navigation.comments }}">
          {{ icon('adminUserPostComments') }}
          Pokaż
        </a>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <span>
          Napisanych mikroblogów:
          <b title="Mikroblogów użytkownika (wyłączając usunięte)">{{ userContent.blogs }}</b>
          /
          <b title="Usuniętych mikroblogów">{{ userContent.blogsDeleted }}</b>
        </span>
        <span>
          <a href="{{ navigation.microblogs }}">
            {{ icon('adminUserMicroblogs') }}
            Pokaż
          </a>
        </span>
      </li>
      <li class="list-group-item">
        Napisanych komentarzy pod mikroblogami:
        <b title="Komentarzy pod mikroblogami (wyłączając usunięte)">{{ userContent.blogComments }}</b>
        /
        <b title="Usuniętych komentarzy pod mikroblogami">{{ userContent.blogCommentsDeleted }}</b>
      </li>
      <li class="list-group-item">
        Oddanych głosow na posty: <b>{{ userContent.postVotes }}</b>
      </li>
      <li class="list-group-item">
        Oddanych głosow na mikroblogi: <b>{{ userContent.blogVotes }}</b>
      </li>
      <li class="list-group-item">
        Dodanych raportów: <b>{{ userContent.flags }}</b> / <b>{{ userContent.flagsTotal }}</b>
      </li>
      <li class="list-group-item">
        Wysłanych wiadomości: <b>{{ userContent.privateMessages }}</b>
      </li>
      <li class="list-group-item">
        Utworzonych ofert pracy: <b>{{ userContent.jobOffers }}</b>
      </li>
      <li class="list-group-item">
        Zdobyta reputacja: <b>{{ userContent.reputation }}</b>
      </li>
      <li class="list-group-item">
        {% if userContentAction.canDelete %}
          <form action="{{ userContentAction.url }}" method="POST" class="d-flex flex-wrap gap-2">
            <input type="hidden" name="_token" value="{{ csrf_token() }}">
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deletePosts">Usuń posty</button>
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deletePostComments">Usuń komentarze</button>
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deleteBlogs">Usuń mikroblogi</button>
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deleteBlogComments">Usuń komentarze
              mikroblogów</button>
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deletePostVotes">Usuń głosy na posty</button>
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deleteBlogVotes">Usuń głosy na
              mikroblogi</button>
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deleteFlags">Usuń raporty</button>
            <button class="btn btn-sm btn-secondary" type="submit" name="contentDelete" value="deleteJobOffers">Usuń oferty pracy</button>
          </form>
        {% else %}
          <div class="text-center">
            <span class="text-muted">Konto jest chronione przed masowym usunięciem treści.</span>
          </div>
        {% endif %}
      </li>
    </ul>
  </div>
{% endblock %}
