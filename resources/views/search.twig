{% extends 'layout' %}

{% block title %}
  {{ input_get('q') ? input_get('q') ~ ' :: ' }} Szukaj
  {{ parent() }}
{% endblock %}

{% block container %}

  <div class="row">
    <div class="col-12">

      {% if not hits %}
        <div class="alert alert-danger">
          Wystąpił błąd w połączeniu z serwrem wyszukiwarki. Prosimy spróbować ponownie za jakiś czas.
        </div>
      {% endif %}

      <div id="js-search" v-cloak>
        <ul class="nav nav-pills mb-3">
          <li class="nav-item">
            <a :href="searchLink()" :class="{active: model === ''}" class="nav-link">Wszystkie</a>
          </li>
          <li v-for="(label, filterModel) in filterModels" class="nav-item">
            <a :href="searchLink(filterModel)" :class="{active: filterModel === model}" class="nav-link">${ label }</a>
          </li>
        </ul>

        <p class="text-muted">Wyniki <strong>${ hits.meta.from } - ${ hits.meta.to }</strong> z <strong>${ hits.meta.total }</strong> znalezione w czasie <strong>${ hits.took } ms.</strong></p>

        <ul class="list-inline">
          <li class="list-inline-item dropdown">
            <a class="dropdown-toggle text-muted" id="dropdownMenuButton" data-toggle="dropdown">
              Wszystkie kategorie
            </a>

            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a v-for="(category, id) in categories" :key="id" class="dropdown-item" href="javascript:" v-html="category"></a>
            </div>
          </li>

          <li class="list-inline-item dropdown">
            <a class="dropdown-toggle text-muted" id="dropdownMenuButton" data-toggle="dropdown">
              ${ sortOptions[defaultSort] }
            </a>

            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a v-for="(label, option) in sortOptions" @click="setSort(option)" class="dropdown-item" href="#">
                <i v-if="option === defaultSort" class="fa fa-check"></i>

                ${ label }
              </a>
            </div>
          </li>
        </ul>

        <component v-if="hits.meta.total" :is="getComponent()" :hits="hits.data"></component>
        <div v-else class="card card-body bg-light p-2 empty-result mt-4">
          <p>
            Nie znaleźliśmy stron, które spełniają Twoje kryteria wyszukiwania.<br>
            <a href="{{ route('home') }}">Wejdź na naszą stronę główną</a>, a być może znajdziesz coś dla siebie!
          </p>
        </div>

        <vue-pagination :current-page="hits.meta.current_page" :total-pages="hits.meta.last_page"></vue-pagination>
      </div>
    </div>
  </div>
{% endblock %}

{% block head %}
  {{ parent() }}

  <script type="text/javascript">
    var model = '{{ model }}';
    var query = '{{ query|raw }}';
    var sort = '{{ sort|raw }}';
    var hits = {{ hits|raw }};
    var postsPerPage = {{ posts_per_page }};
    var categories = {{ categories|raw }};
  </script>
{% endblock %}

