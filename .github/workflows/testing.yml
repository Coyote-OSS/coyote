name: Testing
on: [ push ]

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v2

            #- name: Add user
            #  run: sudo addgroup --gid 1000 nginx && sudo useradd --uid 1000 -g nginx nginx

            - name: Setup config
              run: cp .env.testing .env

            - name: Run docker containers
              run: docker-compose build && docker-compose up -d

            - name: Install packages
              run: docker-compose exec -T php make install

            - name: Create uploads directory
              run: mkdir public/uploads

            - name: Create uploads directory
              run: sudo chown -R nginx:nginx ./

            - name: Run tests
              run: docker-compose exec -T php php vendor/bin/phpunit

            - name: Run Dusk
              run: docker-compose exec -T php php artisan dusk

